var BreezeGrid;(function(n){function r(n,t){if(t)for(var i in t)t.hasOwnProperty(i)&&(typeof t[i]=="object"?r(n[i],t[i]):n[i]=t[i]);return n}function e(){ko.extenders.numeric||(ko.extenders.numeric=function(n,t){var i=ko.computed({read:n,write:function(i){var u=n(),f=Math.pow(10,t),e=isNaN(i)?0:parseFloat(+i),r=Math.round(e*f)/f;r!==u?n(r):e!==u&&n.notifySubscribers(r)}}).extend({notify:"always"});return i(n()),i})}var u=function(){function n(n){var t=this;this.options=n;this.sortColumn=ko.observable(null);this.sortDesc=ko.observable(!1);this.totalCount=ko.observable(0);this.rows=ko.observableArray();this.loading=ko.observable(!0);e();(n.plugins||[]).forEach(function(n){var i=typeof n=="function"?new n:n,r={};t.initPlugin(i,r);i.init(t,r)});n.columns.forEach(this.initColumn);this.sortColumn(n.columns[0]);this.columns=ko.observableArray(n.columns);this.templates=this.getDefaultTemplates();this.dataProvider=n.dataProvider}return n.prototype.initPlugin=function(n,t){for(var i in n)typeof n[i]=="function"&&(typeof this[i]=="function"&&(t[i]=this[i].bind(this)),this[i]=n[i].bind(n))},n.prototype.initColumn=function(i){!i.field&&i.fieldName?i.field=function(n){return n[this.fieldName]}:i.field&&!i.fieldName&&(i.fieldName=n.getExpression(i.field));typeof i.width=="undefined"?i.width=null:typeof i.width=="number"&&(i.width=i.width+"px");typeof i.sortable=="undefined"&&(i.sortable=!0);i.sortExpression||(i.sortExpression=i.fieldName);i.headerText||(i.headerText=i.fieldName);i.viewTemplate||(i.viewTemplate=t.Default)},n.getExpression=function(n){var i=n.toString(),t=/return .*\.(\w+);?/.exec(i);return t!=null?t[1]:null},n.prototype.performSort=function(n){this.sortColumn()==n?this.sortDesc(!this.sortDesc()):(this.sortColumn(n),this.sortDesc(!1));this.search()},n.prototype.getCurrentView=function(n,t){var i=ko.utils.unwrapObservable(n.field(t)),r=n.formatter?n.formatter(i,t):i,u=n.viewTemplate;return u(n,r,t)},n.prototype.search=function(){var n=this,t;this.loading(!0);t=this.getQueryOptions();this.dataProvider.executeQuery(t,function(t){n.searchComplete(t);n.rows(t.results);n.setTotalCount(t);n.loading(!1)})},n.prototype.setTotalCount=function(n){this.totalCount(n.results.length)},n.prototype.getQueryOptions=function(){return{sortDesc:this.sortDesc(),sortColumn:this.sortColumn().sortExpression}},n.prototype.searchComplete=function(){},n.prototype.getDefaultTemplates=function(){return{headerRowTemplate:"<!-- ko template: {name: headerCellTemplateName, foreach: columns } --><!-- /ko -->",headerCellTemplate:'<th data-bind="text: headerText, style: {width: width}"><\/th>',sortableHeaderCellTemplate:'<th data-bind="text: headerText, style: {width: width}, css: {sortable: sortable, sort: $parent.sortColumn()==$data, sortdesc: $parent.sortDesc()},click: $parent.performSort.bind($parent,$data)"><\/th>',footerRowTemplate:'<td data-bind="attr: {colspan: columns().length }"><div class="footcontainer" data-bind="template: \'footerTemplate\'"><\/div><\/td>',footerTemplate:'<div class="recordcount"><span data-bind="text: totalCount"><\/span> Records<\/div>'}},n.prototype.getRowTemplate=function(){var n="";return this.options.rowCssClass&&(n="attr: {'class': $parent.options.rowCssClass($data) }, "),this.options.rowBindings&&(n+=this.options.rowBindings),'<tr data-bind="foreach: $parent.columns, '+n+'"><td class="cell" data-bind="breezeCell: $data, style: {width: width}"><\/td><\/tr>'},n.prototype.headerCellTemplateName=function(n){return n.sortable?"sortableHeaderCellTemplate":"headerCellTemplate"},n.prototype.initBindings=function(){},n}(),i,t,f;n.BreezeGrid=u;i=function(){function n(n,t,i){this.manager=n;this.query=t;this.entityTypeName=i}return n.prototype.executeQuery=function(n,t){var i=this.query,r;return i=n.sortDesc?i.orderByDesc(n.sortColumn):i.orderBy(n.sortColumn),n.includeTotalCount&&(i=i.inlineCount()),typeof n.currentPage!="undefined"&&(r=(n.currentPage-1)*n.pageSize,i=i.skip(r).take(n.pageSize)),this.manager.executeQuery(i,t)},n.prototype.createEntity=function(){return this.manager.createEntity(this.entityTypeName)},n.prototype.saveChanges=function(n){return this.manager.saveChanges(n)},n}();n.BreezeDataProvider=i;t=function(){function n(){}return n.Default=function(n,t){return{div:{text:t,attr:{title:t},style:{width:n.width}}}},n.prototype.Default=function(t,i,r){return n.Default(t,i,r)},n.prototype.ExtendDefault=function(t){return function(i,u,f){var e=n.Default(i,u,f);return r(e,t(f))}},n.prototype.Hyperlink=function(n){return function(t,i,r){return{a:{text:i,attr:{href:n(r),title:i},style:{width:t.width}}}}},n}();n.ViewBuilder=t,function(n){var u=function(){function n(){}return n.prototype.getTemplate=function(n,t){return{input:{value:n.field(t),attr:{type:"text","class":"form-control"}}}},n}(),t,i,r;n.Text=u;t=function(){function n(){}return n.prototype.getTemplate=function(n,t){return{input:{checked:n.field(t),attr:{type:"checkbox"}}}},n}();n.Checkbox=t;i=function(){function n(n,t){this.valueGetter=n;this.options=t}return n.prototype.getTemplate=function(n,t){var i={select:{attr:{"class":"form-control"},value:this.valueGetter(t)}};return ko.utils.extend(i.select,this.options),i},n}();n.Select=i;r=function(){function n(n,t){this.valueGetter=n;this.options=t}return n.prototype.getTemplate=function(n,t){var i=this.valueGetter(t),u,r;if(ko.isObservable(i))return u=ko.computed({read:function(){return i().split(", ")},write:function(n){i(n.join(", "))}}),r={select:{attr:{"class":"form-control",multiple:"multiple"},selectedOptions:u}},ko.utils.extend(r.select,this.options),r},n}();n.MultiSelect=r}(n.Editors||(n.Editors={}));f=n.Editors})(BreezeGrid||(BreezeGrid={})),function(){var t=function(){function n(n,t){this.templateName=n;this.templates=t}return n.prototype.data=function(n,t){if(this.templates._data=this.templates._data||{},this.templates._data[this.templateName]=this.templates._data[this.templateName]||{},arguments.length===1)return this.templates._data[this.templateName][n];this.templates._data[this.templateName][n]=t},n.prototype.text=function(n){if(arguments.length===0)return this.templates[this.templateName];this.templates[this.templateName]=n},n}(),n;ko.bindingHandlers.breezeGrid={init:function(i,r,u,f,e){var o=r(),s=$(i),l=o.templates,h,c;return n||(n=new ko.nativeTemplateEngine,n.renderTemplate=function(n,i,r){var u=new t(n,l);return this.renderTemplateSource(u,i,r)},ko.setTemplateEngine(n)),h=$('<div class="ajaxloader"><\/div><table class="table table-condensed '+(o.options.tableCssClass||"")+'"><thead><tr data-bind="template: \'headerRowTemplate\'"><\/tr><\/thead><tbody data-bind="foreach: rows">'+o.getRowTemplate()+"<\/tbody><tfoot><tr data-bind=\"template: 'footerRowTemplate'\"><\/tfoot><\/table>"),s.addClass("breezeGrid loading "),o.initBindings(s),s.append(h),o.loading.subscribe(function(n){s.toggleClass("loading",n)}),c=e.createChildContext(r),ko.applyBindingsToDescendants(c,i),s.show(),{controlsDescendantBindings:!0}}};ko.bindingHandlers.breezeCell={update:function(n,t,i,r,u){var o=t(),s=u.$parent,h=$(n),a=u.$parents[1],c,f,e,l;h.empty();o.cssClass&&h.attr("class","cell "+o.cssClass(s));f=a.getCurrentView(o,s);for(e in f)f.hasOwnProperty(e)&&(c=$("<"+e+"/>"),h.append(c),l=f[e],ko.applyBindingsToNode(c[0],l,s));return{controlsDescendantBindings:!0}}}}(BreezeGrid||(BreezeGrid={})),function(n){(function(n){var t=function(){function n(){}return n.prototype.init=function(n,t){this.grid=n;this.original=t},n.prototype.getCurrentView=function(n,t){return t.editing()&&n.editor?n.editorInstance.getTemplate(n,t):this.original.getCurrentView(n,t)},n.prototype.initColumn=function(n){this.original.initColumn(n);n.editor&&(n.editorInstance=typeof n.editor=="function"?new n.editor:n.editor)},n.prototype.addNew=function(){var n=this.grid.dataProvider.createEntity();n.editing=ko.observable(!0);this.grid.rows.unshift(n)},n.prototype.editRow=function(n){return n.editing(!0),!0},n.prototype.cancelEditRow=function(n){var t=n;t.entityAspect.entityState==breeze.EntityState.Added?this.grid.rows.remove(n):(t.entityAspect.rejectChanges(),n.editing(!1))},n.prototype.saveRow=function(n){this.grid.dataProvider.saveChanges([n]).then(function(){n.editing(!1)}).fail(function(n){alert(n.entityErrors.map(function(n){return n.errorMessage}).join(","))})},n.prototype.deleteRow=function(n){var t=this;$("#dialog-delete").length==0&&$("body").append(this.getDeleteDialogTemplate());$("#dialog-delete .btn-primary").one("click",function(){n.entityAspect.setDeleted();t.grid.dataProvider.saveChanges([n]).then(function(){$("#dialog-delete").modal("hide");t.grid.rows.remove(n)}).fail(function(n){$("#dialog-delete").modal("hide");alert(n)})});$("#dialog-delete").on("hide.bs.modal",function(){$("#dialog-delete .btn-primary").unbind("click")}).modal()},n.prototype.getDeleteDialogTemplate=function(){return'<div class="modal fade" id="dialog-delete"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;<\/span><\/button><h4 class="modal-title">Confirm Delete<\/h4><\/div><div class="modal-body"><p>Are you sure you want to delete this record?<\/p><\/div><div class="modal-footer"><button type="button" class="btn btn-primary">Yes<\/button><button type="button" class="btn btn-default" data-dismiss="modal">No<\/button><\/div><\/div><!-- /.modal-content --><\/div><!-- /.modal-dialog --><\/div><!-- /.modal -->'},n.prototype.getDefaultTemplates=function(){var n=this.original.getDefaultTemplates();return n.headerRowTemplate='<th class="icons"><\/th><!-- ko template: {name: headerCellTemplateName, foreach: columns } --><!-- /ko -->',n.viewIconsTemplate='<button type="button" class="btn btn-primary btn-xs edit" title="Edit" data-bind="click: $parent.editRow.bind($parent)"><span class="glyphicon glyphicon-pencil"><\/span><\/button><button type="button" class="btn btn-danger btn-xs delete" title="Delete" data-bind="click: $parent.deleteRow.bind($parent)"><span class="glyphicon glyphicon-remove"><\/span><\/button>',n.editIconsTemplate='<button type="button" class="btn btn-success btn-xs" title="Save Changes" data-bind="click: $parent.saveRow.bind($parent)"><span class="glyphicon glyphicon-ok"><\/span><\/button><button type="button" class="btn btn-warning btn-xs" title="Cancel Edit" data-bind="click: $parent.cancelEditRow.bind($parent)"><span class="glyphicon glyphicon-thumbs-down"><\/span><\/button>',n.footerRowTemplate='<td class="icons"><\/td>'+n.footerRowTemplate,n},n.prototype.getRowTemplate=function(){var n="";return this.grid.options.rowCssClass&&(n="attr: {'class': $parent.options.rowCssClass($data) }, "),this.grid.options.rowBindings&&(n+=this.grid.options.rowBindings),'<tr data-bind="'+n+'"><td class="icons" data-bind="template: editing() ? \'editIconsTemplate\' : \'viewIconsTemplate\'"><\/td><!-- ko foreach: $parent.columns  --><td class="cell" data-bind="breezeCell: $data, style: {width: width}"><\/td><!-- /ko --><\/tr>'},n.prototype.searchComplete=function(n){n.results.forEach(function(n){return n.editing=n.editing||ko.observable(!1)});this.original.searchComplete(n)},n.prototype.initBindings=function(n){n.addClass("editable")},n}();n.Editing=t})(n.Plugins||(n.Plugins={}));var t=n.Plugins}(BreezeGrid||(BreezeGrid={})),function(n){(function(n){var t=function(){function n(n){typeof n=="undefined"&&(n=20);this.currentPage=ko.observable(1).extend({numeric:0});this.currentPageChanging=!1;this.pageSizeChanging=!1;this.pageSize=ko.observable(n);this.pageSizes=[10,20,50,100];n!=20&&(this.pageSizes.push(n),this.pageSizes=this.pageSizes.sort(function(n,t){return n-t}))}return n.prototype.init=function(n,t){var i=this;this.grid=n;this.original=t;this.pageCount=ko.computed(function(){return Math.ceil(n.totalCount()/i.pageSize())});this.currentPage.subscribe(function(){i.grid.dataProvider&&(i.currentPageChanging=!0,n.search(),i.currentPageChanging=!1)},this);this.pageSize.subscribe(function(){i.grid.dataProvider&&(i.pageSizeChanging=!0,n.search(),i.pageSizeChanging=!1)},this);n.paging=this},n.prototype.getQueryOptions=function(){this.currentPageChanging||this.currentPage(1);var n=this.original.getQueryOptions();return n.includeTotalCount=!this.currentPageChanging&&!this.pageSizeChanging,n.currentPage=this.currentPage(),n.pageSize=this.pageSize(),n},n.prototype.getDefaultTemplates=function(){var n=this.original.getDefaultTemplates();return n.footerTemplate='<!-- ko template: "recordCountTemplate" --><!--/ko --><!-- ko template: {name: "pagerTemplate", data: paging } --><!--/ko --><!-- ko template: {name:"pageSizeTemplate", data: paging } --><!--/ko -->',n.recordCountTemplate='<div class="recordcount"><span data-bind="text: totalCount"><\/span> Records<\/div>',n.pagerTemplate='<div class="pager" data-bind="css: { hidden: pageCount()<=1 }"><a href="#" class="glyphicon glyphicon-fast-backward" data-bind="css: { disabled: currentPage()==1 }, click:function() { currentPage(1)}"><\/a> <a href="#" class="glyphicon glyphicon-backward" data-bind="css: { disabled: currentPage()==1 }, click: function() {currentPage(currentPage() > 1 ? currentPage()-1 : 1) }"><\/a> <span>Page <input type="text" class="currentpage" data-bind="value:currentPage" /> of <span class="pagecount" data-bind="text: pageCount()"><\/span><\/span> <a href="#" class="glyphicon glyphicon-forward" data-bind="css: { disabled: currentPage()==pageCount() }, click: function() { currentPage(currentPage()<pageCount() ? currentPage()+1 : pageCount()) }"><\/a> <a href="#" class="glyphicon glyphicon-fast-forward" data-bind="css: { disabled: currentPage()==pageCount() }, click: function() { currentPage(pageCount()) }"><\/a> <\/div>',n.pageSizeTemplate='<div class="pagesize">Show: <select data-bind="options: pageSizes, value: pageSize"><\/select><\/div>',n},n.prototype.setTotalCount=function(n){n.inlineCount>=0&&this.grid.totalCount(n.inlineCount)},n}();n.Paging=t})(n.Plugins||(n.Plugins={}));var t=n.Plugins}(BreezeGrid||(BreezeGrid={}));